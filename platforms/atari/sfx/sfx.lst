mads 1.9.6 build 89 (3 Apr 13)
Source: sfx.a65
     1 				;
     2 				; SFX
     3 				; example by raster/c.p.u., 2006,2009
     4 				;
     5 				;
     6 = 0005			STEREOMODE	equ 5				;5 => Agenda stereo mode
     7 												;0 => compile RMTplayer for mono 4 tracks
     8 				;								;1 => compile RMTplayer for stereo 8 tracks
     9 				;								;2 => compile RMTplayer for 4 tracks stereo L1 R2 R3 L4
    10 				;								;3 => compile RMTplayer for 4 tracks stereo L1 L2 R3 R4
    11 				;
    12 				;
    13 					icl "addresses.a65"			;include addresses
Source: addresses.a65
     1 = 8400			PLAYER    equ $8400
     2 = 87C0			MODUL     equ $87C0
     3 = AA50			SFX_CODE  equ $AA50
    14 					icl "rmtplayr.a65"			;include RMT player routine
Source: rmtplayr.a65
     1 				;*
     2 				;* Raster Music Tracker, RMT Atari routine version 1.20090108
     3 				;* (c) Radek Sterba, Raster/C.P.U., 2002 - 2009
     4 				;* http://raster.atari.org
     5 				;*
     6 				;* Warnings:
     7 				;*
     8 				;* 1. RMT player routine needs 19 itself reserved bytes in zero page (no accessed
     9 				;*    from any other routines) as well as cca 1KB of memory before the "PLAYER"
    10 				;*    address for frequency tables and functionary variables. It's:
    11 				;*	  a) from PLAYER-$03c0 to PLAYER for stereo RMTplayer
    12 				;*    b) from PLAYER-$0320 to PLAYER for mono RMTplayer
    13 				;*
    14 				;* 2. RMT player routine MUST (!!!) be compiled from the begin of the memory page.
    15 				;*    i.e. "PLAYER" address can be $..00 only!
    16 				;*
    17 				;* 3. Because of RMTplayer provides a lot of effects, it spent a lot of CPU time.
    18 				;*
    19 				;* STEREOMODE	equ 0..3			;0 => compile RMTplayer for 4 tracks mono
    20 				;*									;1 => compile RMTplayer for 8 tracks stereo
    21 				;*									;2 => compile RMTplayer for 4 tracks stereo L1 R2 R3 L4
    22 				;*									;3 => compile RMTplayer for 4 tracks stereo L1 L2 R3 R4
    23 													;4 => compile RMTplayer for 4 tracks stereo L1 R1 L2 R2 L3 R3 L4 R4 without delay
    24 				;*
    25 					IFT STEREOMODE==1
    26 				TRACKS		equ 8
    27 					ELS
    28 = 0004			TRACKS		equ 4
    29 					EIF
    30 					
    31 				;*
    32 				;*
    33 				;* RMT FEATures definitions file
    34 				;* For optimizations of RMT player routine to concrete RMT modul only!
    35 					icl "rmt_feat.a65"
Source: rmt_feat.a65
     1 				;* --------BEGIN--------
     2 				;* D:\Projekty\AdamIsMe\platforms\atari\sfx\sfx.rmt
     3 = 0001			FEAT_SFX		equ 1
     4 = 0001			FEAT_GLOBALVOLUMEFADE	equ 1		;RMTGLOBALVOLUMEFADE variable
     5 = 0000			FEAT_NOSTARTINGSONGLINE	equ 0
     6 = 0001			FEAT_INSTRSPEED		equ 1
     7 = 0000			FEAT_CONSTANTSPEED		equ 0		;(30 times)
     8 = 0001			FEAT_COMMAND1		equ 1		;(199 times)
     9 = 0001			FEAT_COMMAND2		equ 1		;(26 times)
    10 = 0000			FEAT_COMMAND3		equ 0		;(0 times)
    11 = 0000			FEAT_COMMAND4		equ 0		;(0 times)
    12 = 0000			FEAT_COMMAND5		equ 0		;(0 times)
    13 = 0000			FEAT_COMMAND6		equ 0		;(0 times)
    14 = 0000			FEAT_COMMAND7SETNOTE		equ 0		;(0 times)
    15 = 0000			FEAT_COMMAND7VOLUMEONLY		equ 0		;(0 times)
    16 = 0000			FEAT_PORTAMENTO		equ 0		;(0 times)
    17 = 0000			FEAT_FILTER		equ 0		;(0 times)
    18 = 0000			FEAT_FILTERG0L		equ 0		;(0 times)
    19 = 0000			FEAT_FILTERG1L		equ 0		;(0 times)
    20 = 0000			FEAT_FILTERG0R		equ 0		;(0 times)
    21 = 0000			FEAT_FILTERG1R		equ 0		;(0 times)
    22 = 0000			FEAT_BASS16		equ 0		;(0 times)
    23 = 0000			FEAT_BASS16G1L		equ 0		;(0 times)
    24 = 0000			FEAT_BASS16G3L		equ 0		;(0 times)
    25 = 0000			FEAT_BASS16G1R		equ 0		;(0 times)
    26 = 0000			FEAT_BASS16G3R		equ 0		;(0 times)
    27 = 0000			FEAT_VOLUMEONLYG0L		equ 0		;(0 times)
    28 = 0000			FEAT_VOLUMEONLYG2L		equ 0		;(0 times)
    29 = 0000			FEAT_VOLUMEONLYG3L		equ 0		;(0 times)
    30 = 0000			FEAT_VOLUMEONLYG0R		equ 0		;(0 times)
    31 = 0000			FEAT_VOLUMEONLYG2R		equ 0		;(0 times)
    32 = 0000			FEAT_VOLUMEONLYG3R		equ 0		;(0 times)
    33 = 0000			FEAT_TABLETYPE		equ 0		;(0 times)
    34 = 0000			FEAT_TABLEMODE		equ 0		;(0 times)
    35 = 0001			FEAT_TABLEGO		equ 1		;(5 times)
    36 = 0000			FEAT_AUDCTLMANUALSET		equ 0		;(0 times)
    37 = 0001			FEAT_VOLUMEMIN		equ 1		;(6 times)
    38 = 0001			FEAT_EFFECTVIBRATO		equ 1		;(7 times)
    39 = 0001			FEAT_EFFECTFSHIFT		equ 1		;(1 times)
    40 				;* --------END--------
    36 				;*
    37 				;* RMT ZeroPage addresses
    38 					org 203
    39 				p_tis
    40 				p_instrstable	org *+2
    41 				p_trackslbstable	org *+2
    42 				p_trackshbstable	org *+2
    43 				p_song			org *+2
    44 				ns				org *+2
    45 				nr				org *+2
    46 				nt				org *+2
    47 				reg1			org *+1
    48 				reg2			org *+1
    49 				reg3			org *+1
    50 				tmp				org *+1
    51 					IFT FEAT_COMMAND2
    52 				frqaddcmd2		org *+1
    53 					EIF
    54 					IFT TRACKS>4
    55 					org PLAYER-$400+$40
    56 					ELS
    57 					org PLAYER-$400+$e0
    58 					EIF
    59 				track_variables
    60 				trackn_db	org *+TRACKS
    61 				trackn_hb	org *+TRACKS
    62 				trackn_idx	org *+TRACKS
    63 				trackn_pause	org *+TRACKS
    64 				trackn_note	org *+TRACKS
    65 				trackn_volume	org *+TRACKS
    66 				trackn_distor 	org *+TRACKS
    67 				trackn_shiftfrq	org *+TRACKS
    68 					IFT FEAT_PORTAMENTO
    69 				trackn_portafrqc org *+TRACKS
    70 				trackn_portafrqa org *+TRACKS
    71 				trackn_portaspeed org *+TRACKS
    72 				trackn_portaspeeda org *+TRACKS
    73 				trackn_portadepth org *+TRACKS
    74 					EIF
    75 				trackn_instrx2	org *+TRACKS
    76 				trackn_instrdb	org *+TRACKS
    77 				trackn_instrhb	org *+TRACKS
    78 				trackn_instridx	org *+TRACKS
    79 				trackn_instrlen	org *+TRACKS
    80 				trackn_instrlop	org *+TRACKS
    81 				trackn_instrreachend	org *+TRACKS
    82 				trackn_volumeslidedepth org *+TRACKS
    83 				trackn_volumeslidevalue org *+TRACKS
    84 					IFT FEAT_VOLUMEMIN
    85 				trackn_volumemin		org *+TRACKS
    86 					EIF
    87 = 0001			FEAT_EFFECTS equ FEAT_EFFECTVIBRATO||FEAT_EFFECTFSHIFT
    88 					IFT FEAT_EFFECTS
    89 				trackn_effdelay			org *+TRACKS
    90 					EIF
    91 					IFT FEAT_EFFECTVIBRATO
    92 				trackn_effvibratoa		org *+TRACKS
    93 					EIF
    94 					IFT FEAT_EFFECTFSHIFT
    95 				trackn_effshift		org *+TRACKS
    96 					EIF
    97 				trackn_tabletypespeed org *+TRACKS
    98 					IFT FEAT_TABLEMODE
    99 				trackn_tablemode	org *+TRACKS
   100 					EIF
   101 				trackn_tablenote	org *+TRACKS
   102 				trackn_tablea		org *+TRACKS
   103 				trackn_tableend		org *+TRACKS
   104 					IFT FEAT_TABLEGO
   105 				trackn_tablelop		org *+TRACKS
   106 					EIF
   107 				trackn_tablespeeda	org *+TRACKS
   108 					IFT FEAT_FILTER||FEAT_BASS16
   109 				trackn_command		org *+TRACKS
   110 					EIF
   111 					IFT FEAT_BASS16
   112 				trackn_outnote		org *+TRACKS
   113 					EIF
   114 					IFT FEAT_FILTER
   115 				trackn_filter		org *+TRACKS
   116 					EIF
   117 				trackn_audf	org *+TRACKS
   118 				trackn_audc	org *+TRACKS
   119 					IFT FEAT_AUDCTLMANUALSET
   120 				trackn_audctl	org *+TRACKS
   121 					EIF
   122 				v_aspeed		org *+1
   123 				track_endvariables
   124 						org PLAYER-$100-$140-$40+2
   125 = 000C			INSTRPAR	equ 12
   126 				tabbeganddistor
   127 FFFF> 8182-81BF> 80 00	 dta frqtabpure-frqtab,$00
   128 8184 80 20		 dta frqtabpure-frqtab,$20
   129 8186 80 40		 dta frqtabpure-frqtab,$40
   130 8188 00 C0		 dta frqtabbass1-frqtab,$c0
   131 818A 80 80		 dta frqtabpure-frqtab,$80
   132 818C 80 A0		 dta frqtabpure-frqtab,$a0
   133 818E 00 C0		 dta frqtabbass1-frqtab,$c0
   134 8190 40 C0		 dta frqtabbass2-frqtab,$c0
   135 						IFT FEAT_EFFECTVIBRATO
   136 8192 00 01 05 0B		vibtabbeg dta 0,vib1-vib0,vib2-vib0,vib3-vib0
   137 8196 00			vib0	dta 0
   138 8197 01 FF FF 01		vib1	dta 1,-1,-1,1
   139 819B 01 00 FF FF 00 01	vib2	dta 1,0,-1,-1,0,1
   140 81A1 01 01 00 FF FF FF + vib3	dta 1,1,0,-1,-1,-1,-1,0,1,1
   141 81AB			vibtabnext
   142 81AB 00					dta vib0-vib0+0
   143 81AC 02 03 04 01				dta vib1-vib0+1,vib1-vib0+2,vib1-vib0+3,vib1-vib0+0
   144 81B0 06 07 08 09 0A 05			dta vib2-vib0+1,vib2-vib0+2,vib2-vib0+3,vib2-vib0+4,vib2-vib0+5,vib2-vib0+0
   145 81B6 0C 0D 0E 0F 10 11 + 		dta vib3-vib0+1,vib3-vib0+2,vib3-vib0+3,vib3-vib0+4,vib3-vib0+5,vib3-vib0+6,vib3-vib0+7,vib3-vib0+8,vib3-vib0+9,vib3-vib0+0
   146 						EIF
   147 81C0					org PLAYER-$100-$140
   148 					IFT FEAT_BASS16
   149 				frqtabbasslo
   150 					dta $F2,$33,$96,$E2,$38,$8C,$00,$6A,$E8,$6A,$EF,$80,$08,$AE,$46,$E6
   151 					dta $95,$41,$F6,$B0,$6E,$30,$F6,$BB,$84,$52,$22,$F4,$C8,$A0,$7A,$55
   152 					dta $34,$14,$F5,$D8,$BD,$A4,$8D,$77,$60,$4E,$38,$27,$15,$06,$F7,$E8
   153 					dta $DB,$CF,$C3,$B8,$AC,$A2,$9A,$90,$88,$7F,$78,$70,$6A,$64,$5E,$00
   154 					EIF
   155 81C0					org PLAYER-$100-$100
   156 8200			frqtab
   157 					ERT [<frqtab]!=0	;* frqtab must begin at the memory page bound! (i.e. $..00 address)
   158 8200			frqtabbass1
   159 8200-82BF> BF B6 AA A1 + 	dta $BF,$B6,$AA,$A1,$98,$8F,$89,$80,$F2,$E6,$DA,$CE,$BF,$B6,$AA,$A1
   160 8210 98 8F 89 80 7A 71 + 	dta $98,$8F,$89,$80,$7A,$71,$6B,$65,$5F,$5C,$56,$50,$4D,$47,$44,$3E
   161 8220 3C 38 35 32 2F 2D + 	dta $3C,$38,$35,$32,$2F,$2D,$2A,$28,$25,$23,$21,$1F,$1D,$1C,$1A,$18
   162 8230 17 16 14 13 12 11 + 	dta $17,$16,$14,$13,$12,$11,$10,$0F,$0E,$0D,$0C,$0B,$0A,$09,$08,$07
   163 8240			frqtabbass2
   164 8240 FF F1 E4 D8 CA C0 + 	dta $FF,$F1,$E4,$D8,$CA,$C0,$B5,$AB,$A2,$99,$8E,$87,$7F,$79,$73,$70
   165 8250 66 61 5A 55 52 4B + 	dta $66,$61,$5A,$55,$52,$4B,$48,$43,$3F,$3C,$39,$37,$33,$30,$2D,$2A
   166 8260 28 25 24 21 1F 1E + 	dta $28,$25,$24,$21,$1F,$1E,$1C,$1B,$19,$17,$16,$15,$13,$12,$11,$10
   167 8270 0F 0E 0D 0C 0B 0A + 	dta $0F,$0E,$0D,$0C,$0B,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$00
   168 8280			frqtabpure
   169 8280 F3 E6 D9 CC C1 B5 + 	dta $F3,$E6,$D9,$CC,$C1,$B5,$AD,$A2,$99,$90,$88,$80,$79,$72,$6C,$66
   170 8290 60 5B 55 51 4C 48 + 	dta $60,$5B,$55,$51,$4C,$48,$44,$40,$3C,$39,$35,$32,$2F,$2D,$2A,$28
   171 82A0 25 23 21 1F 1D 1C + 	dta $25,$23,$21,$1F,$1D,$1C,$1A,$18,$17,$16,$14,$13,$12,$11,$10,$0F
   172 82B0 0E 0D 0C 0B 0A 09 + 	dta $0E,$0D,$0C,$0B,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$00,$00
   173 					IFT FEAT_BASS16
   174 				frqtabbasshi
   175 					dta $0D,$0D,$0C,$0B,$0B,$0A,$0A,$09,$08,$08,$07,$07,$07,$06,$06,$05
   176 					dta $05,$05,$04,$04,$04,$04,$03,$03,$03,$03,$03,$02,$02,$02,$02,$02
   177 					dta $02,$02,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$00,$00
   178 					dta $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
   179 					EIF
   180 82C0					org PLAYER-$0100
   181 8300			volumetab
   182 8300-87BD> 00 00 00 00 + 	dta $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
   183 8310 00 00 00 00 00 00 + 	dta $00,$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01
   184 8320 00 00 00 00 01 01 + 	dta $00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01,$02,$02,$02,$02
   185 8330 00 00 00 01 01 01 + 	dta $00,$00,$00,$01,$01,$01,$01,$01,$02,$02,$02,$02,$02,$03,$03,$03
   186 8340 00 00 01 01 01 01 + 	dta $00,$00,$01,$01,$01,$01,$02,$02,$02,$02,$03,$03,$03,$03,$04,$04
   187 8350 00 00 01 01 01 02 + 	dta $00,$00,$01,$01,$01,$02,$02,$02,$03,$03,$03,$04,$04,$04,$05,$05
   188 8360 00 00 01 01 02 02 + 	dta $00,$00,$01,$01,$02,$02,$02,$03,$03,$04,$04,$04,$05,$05,$06,$06
   189 8370 00 00 01 01 02 02 + 	dta $00,$00,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$07,$07
   190 8380 00 01 01 02 02 03 + 	dta $00,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$07,$07,$08
   191 8390 00 01 01 02 02 03 + 	dta $00,$01,$01,$02,$02,$03,$04,$04,$05,$05,$06,$07,$07,$08,$08,$09
   192 83A0 00 01 01 02 03 03 + 	dta $00,$01,$01,$02,$03,$03,$04,$05,$05,$06,$07,$07,$08,$09,$09,$0A
   193 83B0 00 01 01 02 03 04 + 	dta $00,$01,$01,$02,$03,$04,$04,$05,$06,$07,$07,$08,$09,$0A,$0A,$0B
   194 83C0 00 01 02 02 03 04 + 	dta $00,$01,$02,$02,$03,$04,$05,$06,$06,$07,$08,$09,$0A,$0A,$0B,$0C
   195 83D0 00 01 02 03 03 04 + 	dta $00,$01,$02,$03,$03,$04,$05,$06,$07,$08,$09,$0A,$0A,$0B,$0C,$0D
   196 83E0 00 01 02 03 04 05 + 	dta $00,$01,$02,$03,$04,$05,$06,$07,$07,$08,$09,$0A,$0B,$0C,$0D,$0E
   197 83F0 00 01 02 03 04 05 + 	dta $00,$01,$02,$03,$04,$05,$06,$07,$08,$09,$0A,$0B,$0C,$0D,$0E,$0F
   198 8400				org PLAYER
   199 				;*
   200 				;* Set of RMT main vectors:
   201 				;*
   202 8400			RASTERMUSICTRACKER
   203 8400 4C 12 84			jmp rmt_init
   204 8403 4C F2 85			jmp rmt_play
   205 8406 4C 0C 86			jmp rmt_p3
   206 8409 4C 52 84			jmp rmt_silence
   207 840C 4C 40 87			jmp SetPokey
   208 					IFT FEAT_SFX
   209 840F 4C 75 85			jmp rmt_sfx			;* A=note(0,..,60),X=channel(0,..,3 or 0,..,7),Y=instrument*2(0,2,4,..,126)
   210 					EIF
   211 8412			rmt_init
   212 8412 86 D3			stx ns
   213 8414 84 D4			sty ns+1
   214 					IFT FEAT_NOSTARTINGSONGLINE==0
   215 8416 48				pha
   216 					EIF
   217 					IFT track_endvariables-track_variables>255
   218 					ldy #0
   219 					tya
   220 				ri0	sta track_variables,y
   221 					sta track_endvariables-$100,y
   222 					iny
   223 					bne ri0
   224 					ELS
   225 8417 A0 75			ldy #track_endvariables-track_variables
   226 8419 A9 00			lda #0
   227 841B 99 DF 80		ri0	sta track_variables-1,y
   228 841E 88				dey
   229 841F D0 FA			bne ri0
   230 					EIF
   231 8421 A0 04			ldy #4
   232 8423 B1 D3			lda (ns),y
   233 8425 8D 00 86			sta v_maxtracklen
   234 8428 C8				iny
   235 					IFT FEAT_CONSTANTSPEED==0
   236 8429 B1 D3			lda (ns),y
   237 842B 8D C1 84			sta v_speed
   238 					EIF
   239 					IFT FEAT_INSTRSPEED==0
   240 					iny
   241 					lda (ns),y
   242 					sta v_instrspeed
   243 					sta v_ainstrspeed
   244 					ELI FEAT_INSTRSPEED>1
   245 					lda #FEAT_INSTRSPEED
   246 					sta v_ainstrspeed
   247 					EIF
   248 842E A0 08			ldy #8
   249 8430 B1 D3		ri1	lda (ns),y
   250 8432 99 C3 00			sta p_tis-8,y
   251 8435 C8				iny
   252 8436 C0 10			cpy #8+8
   253 8438 D0 F6			bne ri1
   254 					IFT FEAT_NOSTARTINGSONGLINE==0
   255 843A 68				pla
   256 843B 48				pha
   257 					IFT TRACKS>4
   258 					asl @
   259 					asl @
   260 					asl @
   261 					clc
   262 					adc p_song
   263 					sta p_song
   264 					pla
   265 					php
   266 					and #$e0
   267 					asl @
   268 					rol @
   269 					rol @
   270 					rol @
   271 					ELS
   272 843C 0A				asl @
   273 843D 0A				asl @
   274 843E 18				clc
   275 843F 65 D1			adc p_song
   276 8441 85 D1			sta p_song
   277 8443 68				pla
   278 8444 08				php
   279 8445 29 C0			and #$c0
   280 8447 0A				asl @
   281 8448 2A				rol @
   282 8449 2A				rol @
   283 					EIF
   284 844A 28				plp
   285 844B 65 D2			adc p_song+1
   286 844D 85 D2			sta p_song+1
   287 					EIF
   288 844F 20 70 84			jsr GetSongLineTrackLineInitOfNewSetInstrumentsOnlyRmtp3
   289 8452			rmt_silence
   290 					IFT STEREOMODE>0
   291 8452 A9 00			lda #0
   292 8454 8D 08 D2			sta $d208
   293 8457 8D 18 D2			sta $d218
   294 845A A0 03			ldy #3
   295 845C 8C 0F D2			sty $d20f
   296 845F 8C 1F D2			sty $d21f
   297 8462 A0 08			ldy #8
   298 8464 99 00 D2		si1	sta $d200,y
   299 8467 99 10 D2			sta $d210,y
   300 846A 88				dey
   301 846B 10 F7			bpl si1
   302 					ELS
   303 					lda #0
   304 					sta $d208
   305 					ldy #3
   306 					sty $d20f
   307 					ldy #8
   308 				si1	sta $d200,y
   309 					dey
   310 					bpl si1
   311 					EIF
   312 					IFT FEAT_INSTRSPEED==0
   313 					lda v_instrspeed
   314 					ELS
   315 846D A9 01			lda #FEAT_INSTRSPEED
   316 					EIF
   317 846F 60				rts
   318 8470			GetSongLineTrackLineInitOfNewSetInstrumentsOnlyRmtp3
   319 8470			GetSongLine
   320 8470 A2 00			ldx #0
   321 8472 8E FE 85			stx v_abeat
   322 8475			nn0
   323 8475 8A			nn1	txa
   324 8476 A8				tay
   325 8477 B1 D1			lda (p_song),y
   326 8479 C9 FE			cmp #$fe
   327 847B B0 2D			bcs nn2
   328 847D A8				tay
   329 847E B1 CD			lda (p_trackslbstable),y
   330 8480 9D E0 80			sta trackn_db,x
   331 8483 B1 CF			lda (p_trackshbstable),y
   332 8485 9D E4 80		nn1a sta trackn_hb,x
   333 8488 A9 00			lda #0
   334 848A 9D E8 80			sta trackn_idx,x
   335 848D A9 01			lda #1
   336 848F 9D EC 80		nn1a2 sta trackn_pause,x
   337 8492 A9 80			lda #$80
   338 8494 9D 00 81			sta trackn_instrx2,x
   339 8497 E8				inx
   340 8498 E0 04		xtracks01	cpx #TRACKS
   341 849A D0 D9			bne nn1
   342 849C A5 D1			lda p_song
   343 849E 18				clc
   344 849F 69 04		xtracks02	adc #TRACKS
   345 84A1 85 D1			sta p_song
   346 84A3 90 1B			bcc GetTrackLine
   347 84A5 E6 D2			inc p_song+1
   348 84A7			nn1b
   349 84A7 4C C0 84			jmp GetTrackLine
   350 84AA			nn2
   351 84AA F0 04			beq nn3
   352 84AC			nn2a
   353 84AC A9 00			lda #0
   354 84AE F0 DF			beq nn1a2
   355 84B0			nn3
   356 84B0 A0 02			ldy #2
   357 84B2 B1 D1			lda (p_song),y
   358 84B4 AA				tax
   359 84B5 C8				iny
   360 84B6 B1 D1			lda (p_song),y
   361 84B8 85 D2			sta p_song+1
   362 84BA 86 D1			stx p_song
   363 84BC A2 00			ldx #0
   364 84BE F0 B5			beq nn0
   365 84C0			GetTrackLine
   366 84C0			oo0
   367 84C0			oo0a
   368 					IFT FEAT_CONSTANTSPEED==0
   369 84C0 A9 FF			lda #$ff
   370 = 84C1			v_speed equ *-1
   371 84C2 8D 1B 85			sta v_bspeed
   372 					EIF
   373 84C5 A2 FF			ldx #-1
   374 84C7			oo1
   375 84C7 E8				inx
   376 84C8 DE EC 80			dec trackn_pause,x
   377 84CB D0 49			bne oo1x
   378 84CD			oo1b
   379 84CD BD E0 80			lda trackn_db,x
   380 84D0 85 D3			sta ns
   381 84D2 BD E4 80			lda trackn_hb,x
   382 84D5 85 D4			sta ns+1
   383 84D7			oo1i
   384 84D7 BC E8 80			ldy trackn_idx,x
   385 84DA FE E8 80			inc trackn_idx,x
   386 84DD B1 D3			lda (ns),y
   387 84DF 85 D9			sta reg1
   388 84E1 29 3F			and #$3f
   389 84E3 C9 3D			cmp #61
   390 84E5 F0 0E			beq oo1a
   391 84E7 B0 3C			bcs oo2
   392 84E9 9D F0 80			sta trackn_note,x
   393 					IFT FEAT_BASS16
   394 					sta trackn_outnote,x
   395 					EIF
   396 84EC C8				iny
   397 84ED B1 D3			lda (ns),y
   398 84EF 4A				lsr @
   399 84F0 29 7E			and #$3f*2
   400 84F2 9D 00 81			sta trackn_instrx2,x
   401 84F5			oo1a
   402 84F5 A9 01			lda #1
   403 84F7 9D EC 80			sta trackn_pause,x
   404 84FA BC E8 80			ldy trackn_idx,x
   405 84FD FE E8 80			inc trackn_idx,x
   406 8500 B1 D3			lda (ns),y
   407 8502 4A				lsr @
   408 8503 66 D9			ror reg1
   409 8505 4A				lsr @
   410 8506 66 D9			ror reg1
   411 8508 A5 D9			lda reg1
   412 					IFT FEAT_GLOBALVOLUMEFADE
   413 850A 38				sec
   414 850B E9 00			sbc #$00
   415 = 850C			RMTGLOBALVOLUMEFADE equ *-1
   416 850D B0 02			bcs voig
   417 850F A9 00			lda #0
   418 8511			voig
   419 					EIF
   420 8511 29 F0			and #$f0
   421 8513 9D F4 80			sta trackn_volume,x
   422 8516			oo1x
   423 8516 E0 03		xtracks03sub1	cpx #TRACKS-1
   424 8518 D0 AD			bne oo1
   425 					IFT FEAT_CONSTANTSPEED==0
   426 851A A9 FF			lda #$ff
   427 = 851B			v_bspeed equ *-1
   428 851C 8D C1 84			sta v_speed
   429 					ELS
   430 					lda #FEAT_CONSTANTSPEED
   431 					EIF
   432 851F 8D 54 81			sta v_aspeed
   433 8522 4C 6A 85			jmp InitOfNewSetInstrumentsOnly
   434 8525			oo2
   435 8525 C9 3F			cmp #63
   436 8527 F0 1B			beq oo63
   437 8529 A5 D9			lda reg1
   438 852B 29 C0			and #$c0
   439 852D F0 09			beq oo62_b
   440 852F 0A				asl @
   441 8530 2A				rol @
   442 8531 2A				rol @
   443 8532 9D EC 80			sta trackn_pause,x
   444 8535 4C 16 85			jmp oo1x
   445 8538			oo62_b
   446 8538 C8				iny
   447 8539 B1 D3			lda (ns),y
   448 853B 9D EC 80			sta trackn_pause,x
   449 853E FE E8 80			inc trackn_idx,x
   450 8541 4C 16 85			jmp oo1x
   451 8544			oo63
   452 8544 A5 D9			lda reg1
   453 					IFT FEAT_CONSTANTSPEED==0
   454 8546 30 0C			bmi oo63_1X
   455 8548 C8				iny
   456 8549 B1 D3			lda (ns),y
   457 854B 8D 1B 85			sta v_bspeed
   458 854E FE E8 80			inc trackn_idx,x
   459 8551 4C D7 84			jmp oo1i
   460 8554			oo63_1X
   461 					EIF
   462 8554 C9 FF			cmp #255
   463 8556 F0 09			beq oo63_11
   464 8558 C8				iny
   465 8559 B1 D3			lda (ns),y
   466 855B 9D E8 80			sta trackn_idx,x
   467 855E 4C D7 84			jmp oo1i
   468 8561			oo63_11
   469 8561 4C 70 84			jmp GetSongLine
   470 8564 4C 0C 86		p2xrmtp3	jmp rmt_p3
   471 8567 CA			p2x0 dex
   472 8568 30 FA			 bmi p2xrmtp3
   473 856A			InitOfNewSetInstrumentsOnly
   474 856A BC 00 81		p2x1 ldy trackn_instrx2,x
   475 856D 30 F8			bmi p2x0
   476 					IFT FEAT_SFX
   477 856F 20 7D 85			jsr SetUpInstrumentY2
   478 8572 4C 67 85			jmp p2x0
   479 8575			rmt_sfx
   480 8575 9D F0 80			sta trackn_note,x
   481 					IFT FEAT_BASS16
   482 					sta trackn_outnote,x
   483 					EIF
   484 8578 A9 F0			lda #$f0				;* sfx note volume*16
   485 = 8579			RMTSFXVOLUME equ *-1		;* label for sfx note volume parameter overwriting
   486 857A 9D F4 80			sta trackn_volume,x
   487 					EIF
   488 857D			SetUpInstrumentY2
   489 857D B1 CB			lda (p_instrstable),y
   490 857F 9D 04 81			sta trackn_instrdb,x
   491 8582 85 D7			sta nt
   492 8584 C8				iny
   493 8585 B1 CB			lda (p_instrstable),y
   494 8587 9D 08 81			sta trackn_instrhb,x
   495 858A 85 D8			sta nt+1
   496 					IFT FEAT_FILTER
   497 					lda #1
   498 					sta trackn_filter,x
   499 					EIF
   500 					IFT FEAT_TABLEGO
   501 					IFT FEAT_FILTER
   502 					tay
   503 					ELS
   504 858C A0 01			ldy #1
   505 					EIF
   506 858E B1 D7			lda (nt),y
   507 8590 9D 44 81			sta trackn_tablelop,x
   508 8593 C8				iny
   509 					ELS
   510 					ldy #2
   511 					EIF
   512 8594 B1 D7			lda (nt),y
   513 8596 9D 10 81			sta trackn_instrlen,x
   514 8599 C8				iny
   515 859A B1 D7			lda (nt),y
   516 859C 9D 14 81			sta trackn_instrlop,x
   517 859F C8				iny
   518 85A0 B1 D7			lda (nt),y
   519 85A2 9D 34 81			sta trackn_tabletypespeed,x
   520 					IFT FEAT_TABLETYPE||FEAT_TABLEMODE
   521 					and #$3f
   522 					EIF
   523 85A5 9D 48 81			sta trackn_tablespeeda,x
   524 					IFT FEAT_TABLEMODE
   525 					lda (nt),y
   526 					and #$40
   527 					sta trackn_tablemode,x
   528 					EIF
   529 					IFT FEAT_AUDCTLMANUALSET
   530 					iny
   531 					lda (nt),y
   532 					sta trackn_audctl,x
   533 					iny
   534 					ELS
   535 85A8 A0 06			ldy #6
   536 					EIF
   537 85AA B1 D7			lda (nt),y
   538 85AC 9D 1C 81			sta trackn_volumeslidedepth,x
   539 					IFT FEAT_VOLUMEMIN
   540 85AF C8				iny
   541 85B0 B1 D7			lda (nt),y
   542 85B2 9D 24 81			sta trackn_volumemin,x
   543 					IFT FEAT_EFFECTS
   544 85B5 C8				iny
   545 					EIF
   546 					ELS
   547 					IFT FEAT_EFFECTS
   548 					ldy #8
   549 					EIF
   550 					EIF
   551 					IFT FEAT_EFFECTS
   552 85B6 B1 D7			lda (nt),y
   553 85B8 9D 28 81			sta trackn_effdelay,x
   554 					IFT FEAT_EFFECTVIBRATO
   555 85BB C8				iny
   556 85BC B1 D7			lda (nt),y
   557 85BE A8				tay
   558 85BF B9 92 81			lda vibtabbeg,y
   559 85C2 9D 2C 81			sta trackn_effvibratoa,x
   560 					EIF
   561 					IFT FEAT_EFFECTFSHIFT
   562 85C5 A0 0A			ldy #10
   563 85C7 B1 D7			lda (nt),y
   564 85C9 9D 30 81			sta trackn_effshift,x
   565 					EIF
   566 					EIF
   567 85CC A9 80			lda #128
   568 85CE 9D 20 81			sta trackn_volumeslidevalue,x
   569 85D1 9D 00 81			sta trackn_instrx2,x
   570 85D4 0A				asl @
   571 85D5 9D 18 81			sta trackn_instrreachend,x
   572 85D8 9D FC 80			sta trackn_shiftfrq,x
   573 85DB A8				tay
   574 85DC B1 D7			lda (nt),y
   575 85DE 9D 40 81			sta trackn_tableend,x
   576 85E1 69 00			adc #0
   577 85E3 9D 0C 81			sta trackn_instridx,x
   578 85E6 A9 0C			lda #INSTRPAR
   579 85E8 9D 3C 81			sta trackn_tablea,x
   580 85EB A8				tay
   581 85EC B1 D7			lda (nt),y
   582 85EE 9D 38 81			sta trackn_tablenote,x
   583 85F1			xata_rtshere
   584 					IFT FEAT_SFX
   585 85F1 60				rts
   586 					ELS
   587 					jmp p2x0
   588 					EIF
   589 85F2			rmt_play
   590 85F2			rmt_p0
   591 85F2 20 40 87			jsr SetPokey
   592 85F5			rmt_p1
   593 					IFT FEAT_INSTRSPEED==0||FEAT_INSTRSPEED>1
   594 					dec v_ainstrspeed
   595 					bne rmt_p3
   596 					EIF
   597 					IFT FEAT_INSTRSPEED==0
   598 					lda #$ff
   599 				v_instrspeed	equ *-1
   600 					sta v_ainstrspeed
   601 					ELI FEAT_INSTRSPEED>1
   602 					lda #FEAT_INSTRSPEED
   603 					sta v_ainstrspeed
   604 					EIF
   605 85F5			rmt_p2
   606 85F5 CE 54 81			dec v_aspeed
   607 85F8 D0 12			bne rmt_p3
   608 85FA EE FE 85			inc v_abeat
   609 85FD A9 FF			lda #$ff
   610 = 85FE			v_abeat equ *-1
   611 85FF C9 FF			cmp #$ff
   612 = 8600			v_maxtracklen equ *-1
   613 8601 F0 03			beq p2o3
   614 8603 4C C0 84			jmp GetTrackLine
   615 8606			p2o3
   616 8606 4C 70 84			jmp GetSongLineTrackLineInitOfNewSetInstrumentsOnlyRmtp3
   617 8609 4C 2F 87		go_ppnext	jmp ppnext
   618 860C			rmt_p3
   619 860C A9 82			lda #>frqtab
   620 860E 85 D6			sta nr+1
   621 8610 A2 03		xtracks05sub1	ldx #TRACKS-1
   622 8612			pp1
   623 8612 BD 08 81			lda trackn_instrhb,x
   624 8615 F0 F2			beq go_ppnext
   625 8617 85 D4			sta ns+1
   626 8619 BD 04 81			lda trackn_instrdb,x
   627 861C 85 D3			sta ns
   628 861E BC 0C 81			ldy trackn_instridx,x
   629 8621 B1 D3			lda (ns),y
   630 8623 85 D9			sta reg1
   631 8625 C8				iny
   632 8626 B1 D3			lda (ns),y
   633 8628 85 DA			sta reg2
   634 862A C8				iny
   635 862B B1 D3			lda (ns),y
   636 862D 85 DB			sta reg3
   637 862F C8				iny
   638 8630 98				tya
   639 8631 DD 10 81			cmp trackn_instrlen,x
   640 8634 90 0A			bcc pp2
   641 8636 F0 08			beq pp2
   642 8638 A9 80			lda #$80
   643 863A 9D 18 81			sta trackn_instrreachend,x
   644 863D			pp1b
   645 863D BD 14 81			lda trackn_instrlop,x
   646 8640 9D 0C 81		pp2	sta trackn_instridx,x
   647 8643 A5 D9			lda reg1
   648 					IFT TRACKS>4
   649 					cpx #4
   650 					bcc pp2s
   651 					lsr @
   652 					lsr @
   653 					lsr @
   654 					lsr @
   655 				pp2s
   656 					EIF
   657 8645 29 0F			and #$0f
   658 8647 1D F4 80			ora trackn_volume,x
   659 864A A8				tay
   660 864B B9 00 83			lda volumetab,y
   661 864E 85 DC			sta tmp
   662 8650 A5 DA			lda reg2
   663 8652 29 0E			and #$0e
   664 8654 A8				tay
   665 8655 B9 82 81			lda tabbeganddistor,y
   666 8658 85 D5			sta nr
   667 865A A5 DC			lda tmp
   668 865C 19 83 81			ora tabbeganddistor+1,y
   669 865F 9D 50 81			sta trackn_audc,x
   670 8662			InstrumentsEffects
   671 					IFT FEAT_EFFECTS
   672 8662 BD 28 81			lda trackn_effdelay,x
   673 8665 F0 21			beq ei2
   674 8667 C9 01			cmp #1
   675 8669 D0 1A			bne ei1
   676 866B BD FC 80			lda trackn_shiftfrq,x
   677 					IFT FEAT_EFFECTFSHIFT
   678 866E 18				clc
   679 866F 7D 30 81			adc trackn_effshift,x
   680 					EIF
   681 					IFT FEAT_EFFECTVIBRATO
   682 8672 18				clc
   683 8673 BC 2C 81			ldy trackn_effvibratoa,x
   684 8676 79 96 81			adc vib0,y
   685 					EIF
   686 8679 9D FC 80			sta trackn_shiftfrq,x
   687 					IFT FEAT_EFFECTVIBRATO
   688 867C B9 AB 81			lda vibtabnext,y
   689 867F 9D 2C 81			sta trackn_effvibratoa,x
   690 					EIF
   691 8682 4C 88 86			jmp ei2
   692 8685			ei1
   693 8685 DE 28 81			dec trackn_effdelay,x
   694 8688			ei2
   695 					EIF
   696 8688 BC 40 81			ldy trackn_tableend,x
   697 868B C0 0D			cpy #INSTRPAR+1
   698 868D 90 31			bcc ei3
   699 868F BD 48 81			lda trackn_tablespeeda,x
   700 8692 10 26			bpl ei2f
   701 8694			ei2c
   702 8694 98				tya
   703 8695 DD 3C 81			cmp trackn_tablea,x
   704 8698 D0 08			bne ei2c2
   705 					IFT FEAT_TABLEGO
   706 869A BD 44 81			lda trackn_tablelop,x
   707 					ELS
   708 					lda #INSTRPAR
   709 					EIF
   710 869D 9D 3C 81			sta trackn_tablea,x
   711 86A0 D0 03			bne ei2a
   712 86A2			ei2c2
   713 86A2 FE 3C 81			inc trackn_tablea,x
   714 86A5			ei2a
   715 86A5 BD 04 81			lda trackn_instrdb,x
   716 86A8 85 D7			sta nt
   717 86AA BD 08 81			lda trackn_instrhb,x
   718 86AD 85 D8			sta nt+1
   719 86AF BC 3C 81			ldy trackn_tablea,x
   720 86B2 B1 D7			lda (nt),y
   721 					IFT FEAT_TABLEMODE
   722 					ldy trackn_tablemode,x
   723 					beq ei2e
   724 					clc
   725 					adc trackn_tablenote,x
   726 				ei2e
   727 					EIF
   728 86B4 9D 38 81			sta trackn_tablenote,x
   729 86B7 BD 34 81			lda trackn_tabletypespeed,x
   730 					IFT FEAT_TABLETYPE||FEAT_TABLEMODE
   731 					and #$3f
   732 					EIF
   733 86BA			ei2f
   734 86BA 38				sec
   735 86BB E9 01			sbc #1
   736 86BD 9D 48 81			sta trackn_tablespeeda,x
   737 86C0			ei3
   738 86C0 BD 18 81			lda trackn_instrreachend,x
   739 86C3 10 1F			bpl ei4
   740 86C5 BD F4 80			lda trackn_volume,x
   741 86C8 F0 1A			beq ei4
   742 					IFT FEAT_VOLUMEMIN
   743 86CA DD 24 81			cmp trackn_volumemin,x
   744 86CD F0 15			beq ei4
   745 86CF 90 13			bcc ei4
   746 					EIF
   747 86D1 A8				tay
   748 86D2 BD 20 81			lda trackn_volumeslidevalue,x
   749 86D5 18				clc
   750 86D6 7D 1C 81			adc trackn_volumeslidedepth,x
   751 86D9 9D 20 81			sta trackn_volumeslidevalue,x
   752 86DC 90 06			bcc ei4
   753 86DE 98				tya
   754 86DF E9 10			sbc #16
   755 86E1 9D F4 80			sta trackn_volume,x
   756 86E4			ei4
   757 					IFT FEAT_COMMAND2
   758 86E4 A9 00			lda #0
   759 86E6 85 DD			sta frqaddcmd2
   760 					EIF
   761 					IFT FEAT_COMMAND1||FEAT_COMMAND2||FEAT_COMMAND3||FEAT_COMMAND4||FEAT_COMMAND5||FEAT_COMMAND6||FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   762 86E8 A5 DA			lda reg2
   763 					IFT FEAT_FILTER||FEAT_BASS16
   764 					sta trackn_command,x
   765 					EIF
   766 86EA 29 70			and #$70
   767 					IFT 1==[FEAT_COMMAND1+FEAT_COMMAND2+FEAT_COMMAND3+FEAT_COMMAND4+FEAT_COMMAND5+FEAT_COMMAND6+[FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY]]
   768 					beq cmd0
   769 					ELS
   770 86EC 4A				lsr @
   771 86ED 4A				lsr @
   772 86EE 8D F2 86			sta jmx+1
   773 86F1 90 FE		jmx	bcc *
   774 86F3 4C 0D 87			jmp cmd0
   775 86F6 EA				nop
   776 86F7 4C FE 86			jmp cmd1
   777 					IFT FEAT_COMMAND2||FEAT_COMMAND3||FEAT_COMMAND4||FEAT_COMMAND5||FEAT_COMMAND6||FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   778 86FA EA				nop
   779 86FB 4C 03 87			jmp cmd2
   780 					EIF
   781 					IFT FEAT_COMMAND3||FEAT_COMMAND4||FEAT_COMMAND5||FEAT_COMMAND6||FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   782 					nop
   783 					jmp cmd3
   784 					EIF
   785 					IFT FEAT_COMMAND4||FEAT_COMMAND5||FEAT_COMMAND6||FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   786 					nop
   787 					jmp cmd4
   788 					EIF
   789 					IFT FEAT_COMMAND5||FEAT_COMMAND6||FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   790 					nop
   791 					jmp cmd5
   792 					EIF
   793 					IFT FEAT_COMMAND6||FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   794 					nop
   795 					jmp cmd6
   796 					EIF
   797 					IFT FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   798 					nop
   799 					jmp cmd7
   800 					EIF
   801 					EIF
   802 					ELS
   803 					IFT FEAT_FILTER||FEAT_BASS16
   804 					lda reg2
   805 					sta trackn_command,x
   806 					EIF
   807 					EIF
   808 86FE			cmd1
   809 					IFT FEAT_COMMAND1
   810 86FE A5 DB			lda reg3
   811 8700 4C 2C 87			jmp cmd0c
   812 					EIF
   813 8703			cmd2
   814 					IFT FEAT_COMMAND2
   815 8703 A5 DB			lda reg3
   816 8705 85 DD			sta frqaddcmd2
   817 8707 BD F0 80			lda trackn_note,x
   818 870A 4C 13 87			jmp cmd0a
   819 					EIF
   820 870D			cmd3
   821 					IFT FEAT_COMMAND3
   822 					lda trackn_note,x
   823 					clc
   824 					adc reg3
   825 					sta trackn_note,x
   826 					jmp cmd0a
   827 					EIF
   828 870D			cmd4
   829 					IFT FEAT_COMMAND4
   830 					lda trackn_shiftfrq,x
   831 					clc
   832 					adc reg3
   833 					sta trackn_shiftfrq,x
   834 					lda trackn_note,x
   835 					jmp cmd0a
   836 					EIF
   837 870D			cmd5
   838 					IFT FEAT_COMMAND5&&FEAT_PORTAMENTO
   839 					IFT FEAT_TABLETYPE
   840 					lda trackn_tabletypespeed,x
   841 					bpl cmd5a1
   842 					ldy trackn_note,x
   843 					lda (nr),y
   844 					clc
   845 					adc trackn_tablenote,x
   846 					jmp cmd5ax
   847 					EIF
   848 				cmd5a1
   849 					lda trackn_note,x
   850 					clc
   851 					adc trackn_tablenote,x
   852 					cmp #61
   853 					bcc cmd5a2
   854 					lda #63
   855 				cmd5a2
   856 					tay
   857 					lda (nr),y
   858 				cmd5ax
   859 					sta trackn_portafrqc,x
   860 					ldy reg3
   861 					bne cmd5a
   862 					sta trackn_portafrqa,x
   863 				cmd5a
   864 					tya
   865 					lsr @
   866 					lsr @
   867 					lsr @
   868 					lsr @
   869 					sta trackn_portaspeed,x
   870 					sta trackn_portaspeeda,x
   871 					lda reg3
   872 					and #$0f
   873 					sta trackn_portadepth,x
   874 					lda trackn_note,x
   875 					jmp cmd0a
   876 					ELI FEAT_COMMAND5
   877 					lda trackn_note,x
   878 					jmp cmd0a
   879 					EIF
   880 870D			cmd6
   881 					IFT FEAT_COMMAND6&&FEAT_FILTER
   882 					lda reg3
   883 					clc
   884 					adc trackn_filter,x
   885 					sta trackn_filter,x
   886 					lda trackn_note,x
   887 					jmp cmd0a
   888 					ELI FEAT_COMMAND6
   889 					lda trackn_note,x
   890 					jmp cmd0a
   891 					EIF
   892 870D			cmd7
   893 					IFT FEAT_COMMAND7SETNOTE||FEAT_COMMAND7VOLUMEONLY
   894 					IFT FEAT_COMMAND7SETNOTE
   895 					lda reg3
   896 					IFT FEAT_COMMAND7VOLUMEONLY
   897 					cmp #$80
   898 					beq cmd7a
   899 					EIF
   900 					sta trackn_note,x
   901 					jmp cmd0a
   902 					EIF
   903 					IFT FEAT_COMMAND7VOLUMEONLY
   904 				cmd7a
   905 					lda trackn_audc,x
   906 					ora #$f0
   907 					sta trackn_audc,x
   908 					lda trackn_note,x
   909 					jmp cmd0a
   910 					EIF
   911 					EIF
   912 870D			cmd0
   913 870D BD F0 80			lda trackn_note,x
   914 8710 18				clc
   915 8711 65 DB			adc reg3
   916 8713			cmd0a
   917 					IFT FEAT_TABLETYPE
   918 					ldy trackn_tabletypespeed,x
   919 					bmi cmd0b
   920 					EIF
   921 8713 18				clc
   922 8714 7D 38 81			adc trackn_tablenote,x
   923 8717 C9 3D			cmp #61
   924 8719 90 07			bcc cmd0a1
   925 871B A9 00			lda #0
   926 871D 9D 50 81			sta trackn_audc,x
   927 8720 A9 3F			lda #63
   928 8722			cmd0a1
   929 					IFT FEAT_BASS16
   930 					sta trackn_outnote,x
   931 					EIF
   932 8722 A8				tay
   933 8723 B1 D5			lda (nr),y
   934 8725 18				clc
   935 8726 7D FC 80			adc trackn_shiftfrq,x
   936 					IFT FEAT_COMMAND2
   937 8729 18				clc
   938 872A 65 DD			adc frqaddcmd2
   939 					EIF
   940 					IFT FEAT_TABLETYPE
   941 					jmp cmd0c
   942 				cmd0b
   943 					cmp #61
   944 					bcc cmd0b1
   945 					lda #0
   946 					sta trackn_audc,x
   947 					lda #63
   948 				cmd0b1
   949 					tay
   950 					lda trackn_shiftfrq,x
   951 					clc
   952 					adc trackn_tablenote,x
   953 					clc
   954 					adc (nr),y
   955 					IFT FEAT_COMMAND2
   956 					clc
   957 					adc frqaddcmd2
   958 					EIF
   959 					EIF
   960 872C			cmd0c
   961 872C 9D 4C 81			sta trackn_audf,x
   962 872F			pp9
   963 					IFT FEAT_PORTAMENTO
   964 					lda trackn_portaspeeda,x
   965 					beq pp10
   966 					dec trackn_portaspeeda,x
   967 					bne pp10
   968 					lda trackn_portaspeed,x
   969 					sta trackn_portaspeeda,x
   970 					lda trackn_portafrqa,x
   971 					cmp trackn_portafrqc,x
   972 					beq pp10
   973 					bcs pps1
   974 					adc trackn_portadepth,x
   975 					bcs pps8
   976 					cmp trackn_portafrqc,x
   977 					bcs pps8
   978 					jmp pps9
   979 				pps1
   980 					sbc trackn_portadepth,x
   981 					bcc pps8
   982 					cmp trackn_portafrqc,x
   983 					bcs pps9
   984 				pps8
   985 					lda trackn_portafrqc,x
   986 				pps9
   987 					sta trackn_portafrqa,x
   988 				pp10
   989 					lda reg2
   990 					and #$01
   991 					beq pp11
   992 					lda trackn_portafrqa,x
   993 					clc
   994 					adc trackn_shiftfrq,x
   995 					sta trackn_audf,x
   996 				pp11
   997 					EIF
   998 872F			ppnext
   999 872F CA				dex
  1000 8730 30 03			bmi rmt_p4
  1001 8732 4C 12 86			jmp pp1
  1002 8735			rmt_p4
  1003 					IFT FEAT_AUDCTLMANUALSET
  1004 					lda trackn_audctl+0
  1005 					ora trackn_audctl+1
  1006 					ora trackn_audctl+2
  1007 					ora trackn_audctl+3
  1008 					tax
  1009 					ELS
  1010 8735 A2 00			ldx #0
  1011 					EIF
  1012 8737			qq1
  1013 8737 8E 6E 87			stx v_audctl
  1014 					IFT FEAT_FILTER
  1015 					IFT FEAT_FILTERG0L
  1016 					lda trackn_command+0
  1017 					bpl qq2
  1018 					lda trackn_audc+0
  1019 					and #$0f
  1020 					beq qq2
  1021 					lda trackn_audf+0
  1022 					clc
  1023 					adc trackn_filter+0
  1024 					sta trackn_audf+2
  1025 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2L
  1026 					lda trackn_audc+2
  1027 					and #$10
  1028 					bne qq1a
  1029 					EIF
  1030 					lda #0
  1031 					sta trackn_audc+2
  1032 				qq1a
  1033 					txa
  1034 					ora #4
  1035 					tax
  1036 					EIF
  1037 				qq2
  1038 					IFT FEAT_FILTERG1L
  1039 					lda trackn_command+1
  1040 					bpl qq3
  1041 					lda trackn_audc+1
  1042 					and #$0f
  1043 					beq qq3
  1044 					lda trackn_audf+1
  1045 					clc
  1046 					adc trackn_filter+1
  1047 					sta trackn_audf+3
  1048 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG3L
  1049 					lda trackn_audc+3
  1050 					and #$10
  1051 					bne qq2a
  1052 					EIF
  1053 					lda #0
  1054 					sta trackn_audc+3
  1055 				qq2a
  1056 					txa
  1057 					ora #2
  1058 					tax
  1059 					EIF
  1060 				qq3
  1061 					IFT FEAT_FILTERG0L||FEAT_FILTERG1L
  1062 					cpx v_audctl
  1063 					bne qq5
  1064 					EIF
  1065 					EIF
  1066 					IFT FEAT_BASS16
  1067 					IFT FEAT_BASS16G1L
  1068 					lda trackn_command+1
  1069 					and #$0e
  1070 					cmp #6
  1071 					bne qq4
  1072 					lda trackn_audc+1
  1073 					and #$0f
  1074 					beq qq4
  1075 					ldy trackn_outnote+1
  1076 					lda frqtabbasslo,y
  1077 					sta trackn_audf+0
  1078 					lda frqtabbasshi,y
  1079 					sta trackn_audf+1
  1080 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG0L
  1081 					lda trackn_audc+0
  1082 					and #$10
  1083 					bne qq3a
  1084 					EIF
  1085 					lda #0
  1086 					sta trackn_audc+0
  1087 				qq3a
  1088 					txa
  1089 					ora #$50
  1090 					tax
  1091 					EIF
  1092 				qq4
  1093 					IFT FEAT_BASS16G3L
  1094 					lda trackn_command+3
  1095 					and #$0e
  1096 					cmp #6
  1097 					bne qq5
  1098 					lda trackn_audc+3
  1099 					and #$0f
  1100 					beq qq5
  1101 					ldy trackn_outnote+3
  1102 					lda frqtabbasslo,y
  1103 					sta trackn_audf+2
  1104 					lda frqtabbasshi,y
  1105 					sta trackn_audf+3
  1106 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2L
  1107 					lda trackn_audc+2
  1108 					and #$10
  1109 					bne qq4a
  1110 					EIF
  1111 					lda #0
  1112 					sta trackn_audc+2
  1113 				qq4a
  1114 					txa
  1115 					ora #$28
  1116 					tax
  1117 					EIF
  1118 					EIF
  1119 873A			qq5
  1120 873A 8E 6E 87			stx v_audctl
  1121 					IFT TRACKS>4
  1122 					IFT FEAT_AUDCTLMANUALSET
  1123 					lda trackn_audctl+4
  1124 					ora trackn_audctl+5
  1125 					ora trackn_audctl+6
  1126 					ora trackn_audctl+7
  1127 					tax
  1128 					ELS
  1129 					ldx #0
  1130 					EIF
  1131 					stx v_audctl2
  1132 					IFT FEAT_FILTER
  1133 					IFT FEAT_FILTERG0R
  1134 					lda trackn_command+0+4
  1135 					bpl qs2
  1136 					lda trackn_audc+0+4
  1137 					and #$0f
  1138 					beq qs2
  1139 					lda trackn_audf+0+4
  1140 					clc
  1141 					adc trackn_filter+0+4
  1142 					sta trackn_audf+2+4
  1143 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2R
  1144 					lda trackn_audc+2+4
  1145 					and #$10
  1146 					bne qs1a
  1147 					EIF
  1148 					lda #0
  1149 					sta trackn_audc+2+4
  1150 				qs1a
  1151 					txa
  1152 					ora #4
  1153 					tax
  1154 					EIF
  1155 				qs2
  1156 					IFT FEAT_FILTERG1R
  1157 					lda trackn_command+1+4
  1158 					bpl qs3
  1159 					lda trackn_audc+1+4
  1160 					and #$0f
  1161 					beq qs3
  1162 					lda trackn_audf+1+4
  1163 					clc
  1164 					adc trackn_filter+1+4
  1165 					sta trackn_audf+3+4
  1166 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG3R
  1167 					lda trackn_audc+3+4
  1168 					and #$10
  1169 					bne qs2a
  1170 					EIF
  1171 					lda #0
  1172 					sta trackn_audc+3+4
  1173 				qs2a
  1174 					txa
  1175 					ora #2
  1176 					tax
  1177 					EIF
  1178 				qs3
  1179 					IFT FEAT_FILTERG0R||FEAT_FILTERG1R
  1180 					cpx v_audctl2
  1181 					bne qs5
  1182 					EIF
  1183 					EIF
  1184 					IFT FEAT_BASS16
  1185 					IFT FEAT_BASS16G1R
  1186 					lda trackn_command+1+4
  1187 					and #$0e
  1188 					cmp #6
  1189 					bne qs4
  1190 					lda trackn_audc+1+4
  1191 					and #$0f
  1192 					beq qs4
  1193 					ldy trackn_outnote+1+4
  1194 					lda frqtabbasslo,y
  1195 					sta trackn_audf+0+4
  1196 					lda frqtabbasshi,y
  1197 					sta trackn_audf+1+4
  1198 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG0R
  1199 					lda trackn_audc+0+4
  1200 					and #$10
  1201 					bne qs3a
  1202 					EIF
  1203 					lda #0
  1204 					sta trackn_audc+0+4
  1205 				qs3a
  1206 					txa
  1207 					ora #$50
  1208 					tax
  1209 					EIF
  1210 				qs4
  1211 					IFT FEAT_BASS16G3R
  1212 					lda trackn_command+3+4
  1213 					and #$0e
  1214 					cmp #6
  1215 					bne qs5
  1216 					lda trackn_audc+3+4
  1217 					and #$0f
  1218 					beq qs5
  1219 					ldy trackn_outnote+3+4
  1220 					lda frqtabbasslo,y
  1221 					sta trackn_audf+2+4
  1222 					lda frqtabbasshi,y
  1223 					sta trackn_audf+3+4
  1224 					IFT FEAT_COMMAND7VOLUMEONLY&&FEAT_VOLUMEONLYG2R
  1225 					lda trackn_audc+2+4
  1226 					and #$10
  1227 					bne qs4a
  1228 					EIF
  1229 					lda #0
  1230 					sta trackn_audc+2+4
  1231 				qs4a
  1232 					txa
  1233 					ora #$28
  1234 					tax
  1235 					EIF
  1236 					EIF
  1237 				qs5
  1238 					stx v_audctl2
  1239 					EIF
  1240 873D			rmt_p5
  1241 					IFT FEAT_INSTRSPEED==0||FEAT_INSTRSPEED>1
  1242 					lda #$ff
  1243 				v_ainstrspeed equ *-1
  1244 					ELS
  1245 873D A9 01			lda #1
  1246 					EIF
  1247 873F 60				rts
  1248 8740			SetPokey
  1249 					IFT STEREOMODE==1		;* L1 L2 L3 L4 R1 R2 R3 R4
  1250 					ldy #$ff
  1251 				v_audctl2 equ *-1
  1252 					lda trackn_audf+0+4
  1253 					ldx trackn_audf+0
  1254 				xstastx01	sta $d210
  1255 					stx $d200
  1256 					lda trackn_audc+0+4
  1257 					ldx trackn_audc+0
  1258 				xstastx02	sta $d211
  1259 					stx $d201
  1260 					lda trackn_audf+1+4
  1261 					ldx trackn_audf+1
  1262 				xstastx03	sta $d212
  1263 					stx $d202
  1264 					lda trackn_audc+1+4
  1265 					ldx trackn_audc+1
  1266 				xstastx04	sta $d213
  1267 					stx $d203
  1268 					lda trackn_audf+2+4
  1269 					ldx trackn_audf+2
  1270 				xstastx05	sta $d214
  1271 					stx $d204
  1272 					lda trackn_audc+2+4
  1273 					ldx trackn_audc+2
  1274 				xstastx06	sta $d215
  1275 					stx $d205
  1276 					lda trackn_audf+3+4
  1277 					ldx trackn_audf+3
  1278 				xstastx07	sta $d216
  1279 					stx $d206
  1280 					lda trackn_audc+3+4
  1281 					ldx trackn_audc+3
  1282 				xstastx08	sta $d217
  1283 					stx $d207
  1284 					lda #$ff
  1285 				v_audctl equ *-1
  1286 				xstysta01	sty $d218
  1287 					sta $d208
  1288 					ELI STEREOMODE==0		;* L1 L2 L3 L4
  1289 					ldy #$ff
  1290 				v_audctl equ *-1
  1291 					lda trackn_audf+0
  1292 					ldx trackn_audc+0
  1293 					sta $d200
  1294 					stx $d201
  1295 					lda trackn_audf+1
  1296 					ldx trackn_audc+1
  1297 					sta $d200+2
  1298 					stx $d201+2
  1299 					lda trackn_audf+2
  1300 					ldx trackn_audc+2
  1301 					sta $d200+4
  1302 					stx $d201+4
  1303 					lda trackn_audf+3
  1304 					ldx trackn_audc+3
  1305 					sta $d200+6
  1306 					stx $d201+6
  1307 					sty $d208
  1308
  1309
  1310 					ELI STEREOMODE==5		;* L1 L2 L3 L4 R1 R2 R3 R4 with delay
  1311
  1312 8740 A9 00		dtrackn_audf0	lda #0
  1313 8742 8D 10 D2						sta $d210
  1314 8745 A9 00		dtrackn_audf1	lda #0
  1315 8747 8D 12 D2						sta $d210+2
  1316 874A A9 00		dtrackn_audf2	lda #0
  1317 874C 8D 14 D2						sta $d210+4
  1318 874F A9 00		dtrackn_audf3	lda #0
  1319 8751 8D 16 D2						sta $d210+6
  1320
  1321 8754 A9 00		dtrackn_audc0	lda #0
  1322 8756 8D 11 D2						sta $d211
  1323 8759 A9 00		dtrackn_audc1	lda #0
  1324 875B 8D 13 D2						sta $d211+2
  1325 875E A9 00		dtrackn_audc2	lda #0
  1326 8760 8D 15 D2						sta $d211+4
  1327 8763 A9 00		dtrackn_audc3	lda #0
  1328 8765 8D 17 D2						sta $d211+6
  1329
  1330 8768 A0 00		vp1	ldy #0
  1331 876A 8C 18 D2			sty $d218
  1332
  1333
  1334 876D A0 FF			ldy #$ff
  1335 = 876E			v_audctl equ *-1
  1336 876F AD 4C 81			lda trackn_audf+0
  1337 8772 AE 50 81			ldx trackn_audc+0
  1338 8775 8D 00 D2			sta $d200
  1339 8778 8D 41 87			sta dtrackn_audf0+1
  1340 877B 8E 01 D2			stx $d201
  1341 877E 8E 55 87			stx dtrackn_audc0+1
  1342 8781 AD 4D 81			lda trackn_audf+1
  1343 8784 AE 51 81			ldx trackn_audc+1
  1344 8787 8D 02 D2			sta $d200+2
  1345 878A 8E 03 D2			stx $d201+2
  1346 878D 8D 46 87			sta dtrackn_audf1+1
  1347 8790 8E 5A 87			stx dtrackn_audc1+1
  1348 8793 AD 4E 81			lda trackn_audf+2
  1349 8796 AE 52 81			ldx trackn_audc+2
  1350 8799 8D 04 D2			sta $d200+4
  1351 879C 8E 05 D2			stx $d201+4
  1352 879F 8D 4B 87			sta dtrackn_audf2+1
  1353 87A2 8E 5F 87			stx dtrackn_audc2+1
  1354 87A5 AD 4F 81			lda trackn_audf+3
  1355 87A8 AE 53 81			ldx trackn_audc+3
  1356 87AB 8D 06 D2			sta $d200+6
  1357 87AE 8E 07 D2			stx $d201+6
  1358 87B1 8D 50 87			sta dtrackn_audf3+1
  1359 87B4 8E 64 87			stx dtrackn_audc3+1
  1360 87B7 8C 08 D2			sty $d208	
  1361 87BA 8C 69 87			sty vp1+1
  1362
  1363
  1364 					ELI STEREOMODE==4		;* L1 L2 L3 L4 R1 R2 R3 R4
  1365 					ldy #$ff
  1366 				v_audctl equ *-1
  1367 					lda trackn_audf+0
  1368 					ldx trackn_audc+0
  1369 					sta $d200
  1370 					sta $d210
  1371 					stx $d201
  1372 					stx $d211
  1373 					lda trackn_audf+1
  1374 					ldx trackn_audc+1
  1375 					sta $d200+2
  1376 					stx $d201+2
  1377 					sta $d210+2
  1378 					stx $d211+2
  1379 					lda trackn_audf+2
  1380 					ldx trackn_audc+2
  1381 					sta $d200+4
  1382 					stx $d201+4
  1383 					sta $d210+4
  1384 					stx $d211+4
  1385 					lda trackn_audf+3
  1386 					ldx trackn_audc+3
  1387 					sta $d200+6
  1388 					stx $d201+6
  1389 					sta $d210+6
  1390 					stx $d211+6
  1391 					sty $d208	
  1392 					sty $d218
  1393
  1394 					ELI STEREOMODE==2		;* L1 R2 R3 L4
  1395 					ldy #$ff
  1396 				v_audctl equ *-1
  1397 					lda trackn_audf+0
  1398 					ldx trackn_audc+0
  1399 					sta $d200
  1400 					stx $d201
  1401 					sta $d210
  1402 					lda trackn_audf+1
  1403 					ldx trackn_audc+1
  1404 					sta $d210+2
  1405 					stx $d211+2
  1406 					lda trackn_audf+2
  1407 					ldx trackn_audc+2
  1408 					sta $d210+4
  1409 					stx $d211+4
  1410 					sta $d200+4
  1411 					lda trackn_audf+3
  1412 					ldx trackn_audc+3
  1413 					sta $d200+6
  1414 					stx $d201+6
  1415 					sta $d210+6
  1416 					sty $d218
  1417 					sty $d208
  1418 					ELI STEREOMODE==3		;* L1 L2 R3 R4
  1419 					ldy #$ff
  1420 				v_audctl equ *-1
  1421 					lda trackn_audf+0
  1422 					ldx trackn_audc+0
  1423 					sta $d200
  1424 					stx $d201
  1425 					lda trackn_audf+1
  1426 					ldx trackn_audc+1
  1427 					sta $d200+2
  1428 					stx $d201+2
  1429 					lda trackn_audf+2
  1430 					ldx trackn_audc+2
  1431 					sta $d210+4
  1432 					stx $d211+4
  1433 					sta $d200+4
  1434 					lda trackn_audf+3
  1435 					ldx trackn_audc+3
  1436 					sta $d210+6
  1437 					stx $d211+6
  1438 					sta $d200+6
  1439 					sty $d218
  1440 					sty $d208
  1441 					EIF
  1442 87BD 60				rts
  1443 87BE			RMTPLAYEREND
    15 				;
    16 				;
    17 					opt h-						;RMT module is standard Atari binary file already
    18 87BE FF FF C0 87 2C AA + 	ins "sfx.rmt"				;include music RMT module
    19 					opt h+
    20 				;
    21 				;
    22 				;
    23 AA31				org SFX_CODE 
    24 					
    25 AA50			new_init                        ; Set VBI address depending on the NTSC or PAL	
    26 AA50-AAEE> 78			sei
    27 AA51 AD 0B D4		loop lda $D40B; vcount
    28 AA54 CD 0B D4		    cmp $D40B; vcount
    29 AA57 F0 FB		    beq *-3
    30 AA59 90 F6		    bcc loop
    31 AA5B C9 83		    cmp #131 ;; BCC #132
    32 AA5D 58				cli
    33 AA5E B0 0A		    BCS finish_init ; PAL
    34 					;ntsc
    35 AA60 A9 8E			lda #<ntsc_vbi   ; low byte
    36 AA62 8D EC AA			sta vbi_address ; low
    37 AA65 A9 AA			lda #>ntsc_vbi   ; hi byte
    38 AA67 8D ED AA			sta vbi_address+1 ; hi
    39 AA6A			finish_init
    40 AA6A AD 24 02 8D E4 AA + 	mwa $224 old_vbi			; Store old VBI
    41 					
    42 				; SET VBI
    43 AA76			enable_vbi:
    44 AA76 AC EC AA			ldy vbi_address
    45 AA79 AE ED AA			ldx vbi_address+1
    46 AA7C A9 07			lda #$07
    47 AA7E 20 5C E4			jsr $e45c					;Start VBI routine
    48 AA81 60				rts
    49
    50 				; restore old VBI routine
    51 AA82			disable_vbi 
    52 AA82 AC E4 AA			ldy old_vbi
    53 AA85 AE E5 AA			ldx old_vbi+1
    54 AA88 A9 07			lda #$07
    55 AA8A 20 5C E4			jsr $e45c					;Start VBI routine
    56 AA8D 60			    rts
    57 				;
    58
    59 AA8E			ntsc_vbi
    60 AA8E CE EB AA			dec	ntsc_counter
    61 AA91 D0 08			bne	vbi
    62 AA93 A9 05			lda #5
    63 AA95 8D EB AA			sta ntsc_counter	
    64 AA98 4C E1 AA		    jmp end_vbi
    65
    66 AA9B			vbi
    67 AA9B AD EE AA			lda vbi_counter
    68 AA9E F0 03			beq skip_counter	; skip decrease if zero
    69 AAA0 CE EE AA			dec vbi_counter
    70 AAA3			skip_counter:
    71
    72 AAA3 AD EA AA			lda call_silence
    73 AAA6 F0 08			beq skip_silence
    74 AAA8 20 09 84			jsr RASTERMUSICTRACKER+9
    75 AAAB A9 00			lda #$0
    76 AAAD 8D EA AA			sta call_silence				;reinit value
    77 					
    78 AAB0			skip_silence:
    79
    80 AAB0 AD E9 AA			lda sound_active
    81 AAB3 F0 2C			beq end_vbi
    82 					
    83 				;
    84 AAB5 AD E6 AA			lda sfx_effect
    85 AAB8 30 0E			bmi music_part	; if #$FF
    86 AABA 0A				asl @						; * 2
    87 AABB A8				tay							;Y = 2,4,..,16	instrument number * 2 (0,2,4,..,126)
    88 AABC A2 03			ldx #3						;X = 3			channel (0..3 or 0..7 for stereo module)
    89 AABE A9 00			lda #0						;A = 12			note (0..60)
    90 AAC0 20 0F 84			jsr RASTERMUSICTRACKER+15	;RMT_SFX start tone (It works only if FEAT_SFX is enabled !!!)
    91
    92 AAC3 A9 FF			lda #$ff
    93 AAC5 8D E6 AA			sta sfx_effect				;reinit value
    94
    95 AAC8			music_part:
    96 AAC8 AD E8 AA		    lda music_plays
    97 AACB F0 14		    beq end_vbi
    98
    99 AACD AD E7 AA			lda track_to_play
   100 AAD0 30 0C			bmi not_setting_track	    ; if $ff then we are not setting a track
   101 					
   102 AAD2 A2 C0			ldx #<MODUL					;low byte of RMT module to X reg
   103 AAD4 A0 87			ldy #>MODUL					;hi byte of RMT module to Y reg
   104 AAD6 20 00 84			jsr RASTERMUSICTRACKER		;Init
   105 					
   106 AAD9 A9 FF			lda #$ff
   107 AADB 8D E7 AA			sta track_to_play				;reinit value
   108
   109 AADE			not_setting_track:
   110 AADE 20 03 84			jsr RASTERMUSICTRACKER+3	;1 play
   111
   112 AAE1			end_vbi:
   113 AAE1 4C 62 E4			jmp $e462					;end vbi
   114 				;
   115 				;
   116 				;
   117 AAE4 00 00		old_vbi dta 0,0
   118 AAE6 FF			sfx_effect dta $ff				;sfx number variable
   119 AAE7 FF			track_to_play dta $ff			;track to play
   120 AAE8 01			music_plays dta 1				;1 if plays - turnable with option key
   121 AAE9 01			sound_active dta 1				;1 if active
   122 AAEA 00			call_silence dta 0
   123 AAEB 05			ntsc_counter dta 5
   124 AAEC 9B AA		vbi_address dta .LO(vbi), .HI(vbi)
   125 AAEE 00			vbi_counter dta 0
